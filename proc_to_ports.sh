#!/bin/bash

#This script allows you to convert data from /proc/net/tcp (hex) to decimal values. Useful for footprinting using a LFI
#Usage: ./proc_to_ports.sh FILE

#Get a file from argument (/proc/net/tcp)
FILE_TO_CONVERT="$1"

{
	#Get rid of first line
	read
	#Read every lines
	while read -r LINE
	do
		IP_PORT_HEX=$(echo "$LINE"|cut -d " " -f2)

		#Convert each port number from hex to decimal
		PORT_DEC=$(echo "ibase=16; "$(echo "$IP_PORT_HEX"|cut -d ":" -f2)|bc)

		IP_DEC=$(echo "$IP_PORT_HEX"|cut -d ":" -f1)
		IP_DEC_ARRAY=()
		#Compute every bytes and convert them from hex to dec
		for (( i=0; i<${#IP_DEC}; i+=2 ))
		do
			IP_DEC_ARRAY+=($(echo "ibase=16; ${IP_DEC:$i:2}"|bc))
		done

		#Reverse the order of array
		IP_DEC=$(printf '%s\n' "${IP_DEC_ARRAY[@]}"|tac| tr '\n' '.')

		#Print result
		echo "${IP_DEC::-1}:$PORT_DEC"

	done 
} < "$FILE_TO_CONVERT"
